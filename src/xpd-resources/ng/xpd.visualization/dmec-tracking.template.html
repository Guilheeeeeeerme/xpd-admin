<div class="dmec-tracking-container" ng-if="currentOperation && currentOperation.running" ng-init="initializeComponent()">

	<uib-accordion>

		<div uib-accordion-group class="panel-default" is-open="status.isCustomHeaderOpen">

			<uib-accordion-heading>
				Settings

				<span class="well well-sm">
					<strong>DMEC is starting at</strong> {{ dmecTrackingStartAt | date:'medium' }}
				</span>

				<i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': status.isCustomHeaderOpen, 'glyphicon-chevron-right': !status.isCustomHeaderOpen}">
					
				</i>
			
			</uib-accordion-heading>

			<form name="inputRange.form">

				<div class="checkbox">
					<label>
						<input name="realtime" ng-model="inputRangeForm.realtime" type="checkbox"> Real Time
					</label>
				</div>
				<div class="checkbox">
					<label>
						<input name="keepZoomAtTheEnd" ng-model="inputRangeForm.keepZoomAtTheEnd" type="checkbox"> Keep zoom at the end
					</label>
				</div>

				<p>You will be limited to the <strong>current operation start time</strong> in order to match the events bellow</p>

				<div ng-if="!inputRangeForm.realtime">

					<div class="form-group">
						<label for="startTime">From:</label>
						<input ng-model="inputRangeForm.startTime" type="datetime-local" class="form-control" required min="{{ currentOperation.startDate | date:'yyyy-MM-ddTHH:mm' }}"
						 name="startTime" id="startTime">
					</div>


					<button type="submit" ng-click="actionButtonUseOperationStartDate(currentOperation.startDate)"
					 class="btn btn-default">Use Operation Start Time ({{ currentOperation.startDate | date: 'medium' }})</button>

				</div>

				<div ng-if="inputRangeForm.realtime">

					<div class="form-group">
						<label for="last">Last:</label>
						<input ng-model="inputRangeForm.last" type="number" class="form-control" required name="last" id="last">
					</div>

					<div class="form-group">
						<select ng-model="inputRangeForm.toMilliseconds" class="form-control" required name="toMilliseconds" id="toMilliseconds">
							<option value="86400000">Days</option>
							<option value="3600000">Hours</option>
							<option value="60000">Minutes</option>
							<option value="1000">Seconds</option>
						</select>
					</div>

				</div>

				<button type="submit" ng-click="actionButtonSubmitDmecRange()" ng-disabled="inputRange.form.$invalid" class="btn btn-default">Submit</button>

			</form>
		</div>

	</uib-accordion>

	<div class="dmec-tracking-row dmec-tracking-row-h-40 chart-content">

		<div class="xpd-chart-container-header dmec-chart-label">
			DMEC
		</div>

		<d3-dmec-chart 
			ng-if="dmecTrackingStartAt && zoomStartAt && zoomEndAt"
			threads="4" 
			horizontal="true" 
			on-reading-since="onReadingSince"
			actual-start-at="dmecTrackingStartAt" 
			on-reading="onReading"
		 	zoom-start-at="zoomStartAt" 
		 	zoom-end-at="zoomEndAt">
		</d3-dmec-chart>

	</div>

	<div class="dmec-tracking-row dmec-tracking-row-h-10 chart-content">

		<div class="xpd-chart-container-header dmec-chart-label">
			Zoom
		</div>

		<time-zoom-tool 
			ng-if="zoomStartAt && zoomEndAt" 
			bit-depth-points="bitDepthPoints" 
			zoom-start-at="zoomStartAt" 
			zoom-end-at="zoomEndAt" 
			set-zoom="setZoom" 
			min-depth="0" 
			max-depth="maxDepth">
		</time-zoom-tool>
	</div>

	<div class="dmec-tracking-row dmec-tracking-row-h-10 chart-content">

		<div class="xpd-chart-container-header dmec-chart-label">
			Slips to Slips (Conn)
		</div>

		<dmec-tracking-events 
			tick="currentTick" 
			current-operation='currentOperation'		 
			events='connectionEvents' 
		 	event-type="'CONN'" 
		 	current-event="currentEvent" 
		 	current-block-position="currentBlockPosition"
		 	zoom-start-at="zoomStartAt" 
			zoom-end-at="zoomEndAt"
			set-zoom="setZoom">
		</dmec-tracking-events>

	</div>

	<div class="dmec-tracking-row dmec-tracking-row-h-10 chart-content">

		<div class="xpd-chart-container-header dmec-chart-label">
			Slips to Slips (Trip)
		</div>

		<dmec-tracking-events 
			tick="currentTick" 
			current-operation='currentOperation'
			events='tripEvents' 
			event-type="'TRIP'" 
			current-event="currentEvent" 
			current-block-position="currentBlockPosition"
			zoom-start-at="zoomStartAt" 
			zoom-end-at="zoomEndAt"
			set-zoom="setZoom">
		</dmec-tracking-events>

	</div>

	<div class="dmec-tracking-row dmec-tracking-row-h-10 chart-content">

		<div class="xpd-chart-container-header dmec-chart-label">
			Time
		</div>

		<dmec-tracking-events 
			tick="currentTick" 
			current-operation='currentOperation'		 
			events='timeEvents' 
		 	event-type="'TIME'" 
		 	current-event="currentEvent" 
		 	current-block-position="currentBlockPosition"		 
		 	zoom-start-at="zoomStartAt" 
			zoom-end-at="zoomEndAt"
			set-zoom="setZoom" >
		</dmec-tracking-events>

	</div>

</div>

<div ng-if="!currentOperation.running">
	<span class="xpd-chart-placeholder-text">No running operation</span>
</div>