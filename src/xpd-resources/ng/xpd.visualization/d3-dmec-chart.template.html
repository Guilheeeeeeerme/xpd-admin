<svg ng-if="$tracks" xmlns="http://www.w3.org/2000/svg" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#"
 xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" version='1.1' ng-attr-width='{{ svg.viewWidth }}'
 ng-attr-height='{{ svg.viewHeight }}'>

	<rect 
		class="dmec-bg" 
		fill="white" 
		fill-opacity="0.1" 
		x="0" 
		y="0" 
		ng-attr-width='{{ svg.viewWidth }}' 
		ng-attr-height='{{ svg.viewHeight }}'>
	</rect>

	<!-- y axis ticks -->
	<g class="range-ticks">
		<g ng-repeat="track in $tracks">
			<line 
				ng-repeat="tick in track.ticks" 
				ng-attr-transform="translate( {{ horizontal? 0: track.trackScale(tick) }}, {{ horizontal? track.trackScale(tick): 0 }} )"
				x1='0' 
				y1='0' 
				ng-attr-x2='{{ horizontal? svg.viewWidth: 0  }}' 
				ng-attr-y2='{{ horizontal? 0: svg.viewHeight }}' 
				stroke="#e9e9e9" 
				stroke-opacity="0.2" 
				stroke-width="1" />
		</g>
	</g>

	<svg ng-attr-width='{{ svg.viewWidth }}' ng-attr-height='{{ svg.viewHeight }}' preserveAspectRatio="none" xpd-view-box="viewBox">
		
		<g class="clip-paths">
			<g ng-repeat="track in $tracks">
				<clipPath id="myClip-{{ track.param }}">
					<rect 
						ng-attr-x="{{ horizontal? timeScale(zoomStartAt) : track.trackScale(track.min) }}" 
						ng-attr-y="{{ horizontal? track.trackScale(track.min) : timeScale(zoomStartAt) }}" 
						ng-attr-width='{{ horizontal? zoomArea : ( track.trackScale(track.max) - track.trackScale(track.min) )  }}' 
						ng-attr-height='{{ horizontal? ( track.trackScale(track.max) - track.trackScale(track.min) ): zoomArea }}'
						/>
				</clipPath>
			</g>
		</g>
		
		<!-- x axis ticks -->
		<g class="time-ticks">
			<g 	ng-repeat="tick in timeTicks" 
				ng-attr-transform="translate( {{ horizontal? timeScale(tick): 0 }}, {{ horizontal? 0: timeScale(tick) }} )">
				<line 
					vector-effect="non-scaling-stroke" 
					x1="0" 
					y1="0" 
					ng-attr-x2='{{ horizontal? 0: svg.viewWidth }}' 
					ng-attr-y2='{{ horizontal? svg.viewHeight: 0 }}' 
					stroke="#e9e9e9"
					stroke-opacity="0.2" 
				 	stroke-width="1" />
			</g>
		</g>

		<g class="oldPoints">
			<path 
			id="{{ track.param }}" 
			ng-repeat="track in $tracks" 
			fill="none" 
			stroke="{{ track.color }}" 
			ng-attr-clip-path="url(#myClip-{{ track.param }})" 
			vector-effect="non-scaling-stroke" 
			stroke-width="3" />
		</g>

		<g class="newPoints">
			<path 
			id="{{ track.param }}" 
			ng-repeat="track in $tracks" 
			fill="none" 
			stroke="{{ track.color }}" 
			ng-attr-clip-path="url(#myClip-{{ track.param }})" 
			vector-effect="non-scaling-stroke" 
			stroke-width="3" />
		</g>
	</svg>

	<!-- Following the mouse -->
	<g class="crosshair" ng-if="!horizontal">
		<line x1="0" ng-attr-x2="{{ svg.viewWidth }}" id="crosshair" stroke="black" stroke-opacity="0.5" stroke-width="0.1em" />
	</g>

	<g class="crosshair" ng-if="horizontal">
		<line y1="0" ng-attr-y2="{{ svg.viewHeight }}" id="crosshair" stroke="white" stroke-opacity="0.5" stroke-width="0.1em" />
	</g>

	<g class="bubbles">
		<g 
			ng-repeat="( key, track ) in $tracks" 
			ng-if="$tracks && track.labelPosition != null" 
			id="bubble-{{track.param}}" 
			style="display: none;">
			<circle 
				r="5" 
				fill="none" 
				stroke-width="2" 
				ng-attr-stroke="{{ track.color }}">
			</circle>
		</g>
	</g>

	<g class="legend" ng-if="!horizontal">

		<g class="label" ng-if="$tracks && track.labelPosition != null" ng-repeat="track in $tracks">

			<text 
				font-size="1vw" 
				ng-attr-fill="{{ track.color }}"
				ng-attr-x="{{ track.labelStartAt + ( (track.labelEndAt - track.labelStartAt) * 0.1 )  }}"
				ng-attr-y="{{ track.labelPosition * 25 }}" 
				alignment-baseline="baseline" 
				text-anchor="start">
				{{ track.min }}
			</text>

			<text 
				font-size="1vw" 
				ng-attr-fill="{{ track.color }}" 
				ng-attr-x="{{ track.labelStartAt + ( (track.labelEndAt - track.labelStartAt) * 0.5 ) }}"
			 	ng-attr-y="{{ track.labelPosition * 25 }}" 
			 	alignment-baseline="baseline" 
			 	text-anchor="middle">
				{{ track.label }} ( {{ track.unitMeasure }} )
			</text>

			<text 
				font-size="1vw" 
				ng-attr-fill="{{ track.color }}"
				ng-attr-x="{{ track.labelStartAt + ( (track.labelEndAt - track.labelStartAt) * 0.9 ) }}"
				ng-attr-y="{{ track.labelPosition * 25 }}" 
				alignment-baseline="baseline" 
				text-anchor="end">
				{{ track.max }}
			</text>

			<text 
				id="text-{{track.param}}" 
				style="display: none;"
				font-size="1vw" 
				ng-attr-fill="{{ track.color }}" 
				ng-attr-x="{{ track.labelStartAt + ( (track.labelEndAt - track.labelStartAt) * 0.5 ) }}"
			 	ng-attr-y="{{ svg.viewHeight - ( track.labelPosition * 25 ) }}" 
			 	alignment-baseline="baseline" 
			 	text-anchor="middle">
				{{ track.label }} ( {{ track.unitMeasure }} )
			</text>

		</g>

	</g>

	<g class="legend" ng-if="horizontal">

		<g class="label" ng-if="$tracks && track.labelPosition != null" ng-repeat="track in $tracks">

			<text 
				font-size="1.5vh" 
				ng-attr-fill="{{ track.color }}" 
				ng-attr-y="{{ track.labelStartAt + ( (track.labelEndAt - track.labelStartAt) * 0.1 )  }}"
				ng-attr-x="{{ (track.labelPosition * 50) }}" 
				alignment-baseline="hanging" 
				text-anchor="start">
				{{ track.min }}
			</text>

			<text 
				font-size="1.5vh" 
				ng-attr-fill="{{ track.color }}" 
				ng-attr-y="{{ track.labelStartAt + ( ( track.labelEndAt - track.labelStartAt ) * ( (track.labelPosition+1) / 3 ) ) }}"
				x="0" 
				alignment-baseline="middle" 
				text-anchor="start">
				{{ track.label }} ( {{ track.unitMeasure }} )
			</text>

			<text 
				font-size="1.5vh" 
				ng-attr-fill="{{ track.color }}" 
				ng-attr-y="{{ track.labelStartAt + ( (track.labelEndAt - track.labelStartAt) * 0.9 ) }}"
				ng-attr-x="{{ (track.labelPosition * 50) }}" 
				alignment-baseline="baseline" 
				text-anchor="start">
				{{ track.max }}
			</text>

			<text 
				id="text-{{track.param}}" 
				style="display: none;"
				font-size="1.5vh" 
				ng-attr-fill="{{ track.color }}" 
				ng-attr-x="{{ svg.viewWidth }}"
				ng-attr-y="{{ track.labelStartAt + ( ( track.labelEndAt - track.labelStartAt ) * ( (track.labelPosition+1) / 3 ) ) }}"
				alignment-baseline="middle" 
				text-anchor="end">
			</text>

		</g>

	</g>

	<rect 
		ng-if="listenToMouseMove != null" 
		style="fill: none; pointer-events: all;" 
		class="overlay" 
		ng-dblclick="openScaleModal()"
		ng-init="listenToMouseMove()" 
		x="0" 
		y="0"
		ng-attr-width='{{ svg.viewWidth }}' 
		ng-attr-height='{{ svg.viewHeight }}'>
	</rect>

</svg>